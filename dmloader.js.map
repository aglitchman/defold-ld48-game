{"version":3,"sources":["build/bundle/public/dmloader.js"],"sourcesContent":["// file downloader\n// wraps XMLHttpRequest and adds retry support and progress updates when the\n// content is gzipped (gzipped content doesn't report a computable content length\n// on Google Chrome)\nvar FileLoader = {\n    options: {\n        retryCount: 4,\n        retryInterval: 1000,\n    },\n    // do xhr request with retries\n    request: function(url, method, responseType, currentAttempt) {\n        if (typeof method === 'undefined') throw \"No method specified\";\n        if (typeof method === 'responseType') throw \"No responseType specified\";\n        if (typeof currentAttempt === 'undefined') currentAttempt = 0;\n        var obj = {\n            send: function() {\n                var onprogress = this.onprogress;\n                var onload = this.onload;\n                var onerror = this.onerror;\n\n                var xhr = new XMLHttpRequest();\n                xhr.open(method, url, true);\n                xhr.responseType = responseType;\n                xhr.onprogress = function(e) {\n                    if (onprogress) onprogress(xhr, e);\n                };\n                xhr.onerror = function(e) {\n                    if (currentAttempt == FileLoader.options.retryCount) {\n                        if (onerror) onerror(xhr, e);\n                        return;\n                    }\n                    currentAttempt = currentAttempt + 1;\n                    setTimeout(obj.send.bind(obj), FileLoader.options.retryInterval);\n                };\n                xhr.onload = function(e) {\n                    if (onload) onload(xhr, e);\n                };\n                xhr.send(null);\n            }\n        };\n        return obj;\n    },\n    // Do HTTP HEAD request to get size of resource\n    // callback will receive size or undefined in case of an error\n    size: function(url, callback) {\n        var request = FileLoader.request(url, \"HEAD\", \"text\");\n        request.onerror = function(xhr, e) {\n            callback(undefined);\n        };\n        request.onload = function(xhr, e) {\n            if (xhr.readyState === 4) {\n                if (xhr.status === 200) {\n                    var total = xhr.getResponseHeader('content-length');\n                    callback(total);\n                } else {\n                    callback(undefined);\n                }\n            }\n        };\n        request.send();\n    },\n    // Do HTTP GET request\n    // onprogress(loaded, total)\n    // onerror(error)\n    // onload(response)\n    load: function(url, responseType, estimatedSize, onprogress, onerror, onload) {\n        var request = FileLoader.request(url, \"GET\", responseType);\n        request.onprogress = function(xhr, e) {\n            if (e.lengthComputable) {\n                onprogress(e.loaded, e.total);\n                return;\n            }\n            var contentLength = xhr.getResponseHeader('content-length');\n            var size = contentLength != undefined ? contentLength : estimatedSize;\n            if (size) {\n                onprogress(e.loaded, size);\n            } else {\n                onprogress(e.loaded, e.loaded);\n            }\n        };\n        request.onerror = function(xhr, e) {\n            onerror(\"Error loading '\" + url + \"' (\" + e + \")\");\n        };\n        request.onload = function(xhr, e) {\n            if (xhr.readyState === 4) {\n                if (xhr.status === 200) {\n                    var res = xhr.response;\n                    if (responseType == \"json\" && typeof res === \"string\") {\n                        onload(JSON.parse(res));\n                    } else {\n                        onload(res);\n                    }\n                } else {\n                    onerror(\"Error loading '\" + url + \"' (\" + e + \")\");\n                }\n            }\n        };\n        request.send();\n    }\n};\n\n\nvar EngineLoader = {\n    wasm_size: 2000000,\n    wasm_from: 0,\n    wasm_to: 40,\n\n    wasmjs_size: 250000,\n    wasmjs_from: 40,\n    wasmjs_to: 50,\n\n    asmjs_size: 4000000,\n    asmjs_from: 0,\n    asmjs_to: 50,\n\n    // load .wasm and set Module.instantiateWasm to use the loaded .wasm file\n    // https://github.com/emscripten-core/emscripten/blob/master/tests/manual_wasm_instantiate.html#L170\n    loadWasmAsync: function(src, fromProgress, toProgress, callback) {\n        FileLoader.load(src, \"arraybuffer\", EngineLoader.wasm_size,\n            function(loaded, total) { Progress.calculateProgress(fromProgress, toProgress, loaded, total); },\n            function(error) { throw error; },\n            function(wasm) {\n                Module.instantiateWasm = function(imports, successCallback) {\n                    var wasmInstantiate = WebAssembly.instantiate(new Uint8Array(wasm), imports).then(function(output) {\n                        successCallback(output.instance);\n                    }).catch(function(e) {\n                        console.log('wasm instantiation failed! ' + e);\n                        throw e;\n                    });\n                    return {}; // Compiling asynchronously, no exports.\n                }\n                callback();\n            });\n    },\n\n    // load and start engine script (asm.js or wasm.js)\n    loadScriptAsync: function(src, estimatedSize, fromProgress, toProgress) {\n        FileLoader.load(src, \"text\", estimatedSize,\n            function(loaded, total) { Progress.calculateProgress(fromProgress, toProgress, loaded, total); },\n            function(error) { throw error; },\n            function(response) {\n                var tag = document.createElement(\"script\");\n                tag.text = response;\n                document.head.appendChild(tag);\n            });\n    },\n\n    // load engine (asm.js or wasm.js + wasm)\n    // engine load progress goes from 1-50% for ams.js\n    // engine load progress goes from 0-40% for .wasm and 40-50% for wasm.js\n    load: function(appCanvasId, exeName) {\n        Progress.addProgress(Module.setupCanvas(appCanvasId));\n        if (Module['isWASMSupported']) {\n            EngineLoader.loadWasmAsync(exeName + \".wasm\", EngineLoader.wasm_from, EngineLoader.wasm_to, function(wasm) {\n                EngineLoader.loadScriptAsync(exeName + '_wasm.js', EngineLoader.wasmjs_size, EngineLoader.wasmjs_from, EngineLoader.wasmjs_to);\n            });\n        } else {\n            EngineLoader.loadScriptAsync(exeName + '_asmjs.js', EngineLoader.asmjs_size, EngineLoader.asmjs_from, EngineLoader.asmjs_to);\n        }\n    }\n}\n\n\n/* ********************************************************************* */\n/* Load and combine game archive data that is split into archives        */\n/* ********************************************************************* */\n\nvar GameArchiveLoader = {\n    // which files to load\n    _files: [],\n    _fileIndex: 0,\n    // file\n    //  name: intended filepath of built object\n    //  size: expected size of built object.\n    //  data: combined pieces\n    //  downloaded: total bytes downloaded\n    //  pieces: array of name, offset and data objects\n    //  numExpectedFiles: total number of files expected in description\n    //  lastRequestedPiece: index of last data file requested (strictly ascending)\n    //  totalLoadedPieces: counts the number pieces received\n\n    //MAX_CONCURRENT_XHR: 6,    // remove comment if throttling of XHR is desired.\n\n    isCompleted: false,       // status of process\n\n    _onFileLoadedListeners: [],          // signature: name, data.\n    _onArchiveLoadedListeners:[],        // signature: void\n    _onFileDownloadErrorListeners: [],   // signature: name\n\n    _currentDownloadBytes: 0,\n    _totalDownloadBytes: 0,\n\n    _archiveLocationFilter: function(path) { return \"split\" + path; },\n\n    cleanUp: function() {\n        this._files =  [];\n        this._fileIndex = 0;\n        this.isCompleted = false;\n        this._onGameArchiveLoaderCompletedListeners = [];\n        this._onAllTargetsBuiltListeners = [];\n        this._onFileDownloadErrorListeners = [];\n\n        this._currentDownloadBytes = 0;\n        this._totalDownloadBytes = 0;\n    },\n\n    addListener: function(list, callback) {\n        if (typeof callback !== 'function') throw \"Invalid callback registration\";\n        list.push(callback);\n    },\n    notifyListeners: function(list, data) {\n        for (i=0; i<list.length; ++i) {\n            list[i](data);\n        }\n    },\n\n    addFileDownloadErrorListener: function(callback) {\n        this.addListener(this._onFileDownloadErrorListeners, callback);\n    },\n    notifyFileDownloadError: function(url) {\n        this.notifyListeners(this._onFileDownloadErrorListeners, url);\n    },\n\n    addFileLoadedListener: function(callback) {\n        this.addListener(this._onFileLoadedListeners, callback);\n    },\n    notifyFileLoaded: function(file) {\n        this.notifyListeners(this._onFileLoadedListeners, { name: file.name, data: file.data });\n    },\n\n    addArchiveLoadedListener: function(callback) {\n        this.addListener(this._onArchiveLoadedListeners, callback);\n    },\n    notifyArchiveLoaded: function() {\n        this.notifyListeners(this._onArchiveLoadedListeners);\n    },\n\n    setFileLocationFilter: function(filter) {\n        if (typeof filter !== 'function') throw \"Invalid filter\";\n        this._archiveLocationFilter = filter;\n    },\n\n    // load the archive_files.json with the list of files and their individual\n    // pieces\n    // descriptionUrl: location of text file describing files to be preloaded\n    loadArchiveDescription: function(descriptionUrl) {\n        FileLoader.load(\n            this._archiveLocationFilter(descriptionUrl),\n            \"json\",\n            undefined,\n            function (loaded, total) { },\n            function (error) { GameArchiveLoader.notifyFileDownloadError(descriptionUrl); },\n            function (json) { GameArchiveLoader.onReceiveDescription(json); });\n    },\n\n    onReceiveDescription: function(json) {\n        this._files = json.content;\n        this._totalDownloadBytes = 0;\n        this._currentDownloadBytes = 0;\n\n        // calculate total download size of all files\n        for(var i=0; i<this._files.length; ++i) {\n            this._totalDownloadBytes += this._files[i].size;\n        }\n        this.downloadContent();\n    },\n\n    downloadContent: function() {\n        var file = this._files[this._fileIndex];\n        // if the file consists of more than one piece we prepare an array to store the pieces in\n        if (file.pieces.length > 1) {\n            file.data = new Uint8Array(file.size);\n        }\n        // how many pieces to download at a time\n        var limit = file.pieces.length;\n        if (typeof this.MAX_CONCURRENT_XHR !== 'undefined') {\n            limit = Math.min(limit, this.MAX_CONCURRENT_XHR);\n        }\n        // download pieces\n        for (var i=0; i<limit; ++i) {\n            this.downloadPiece(file, i);\n        }\n    },\n\n    notifyDownloadProgress: function() {\n        Progress.calculateProgress(50, 100, this._currentDownloadBytes, this._totalDownloadBytes);\n    },\n\n    downloadPiece: function(file, index) {\n        if (index < file.lastRequestedPiece) {\n            throw \"Request out of order\";\n        }\n\n        var piece = file.pieces[index];\n        file.lastRequestedPiece = index;\n        file.totalLoadedPieces = 0;\n\n        var total = 0;\n        var downloaded = 0;\n        var url = this._archiveLocationFilter('/' + piece.name);\n\n        FileLoader.load(\n            url, \"arraybuffer\", undefined,\n            function (loaded, total) {\n                var delta = loaded - downloaded;\n                downloaded = loaded;\n                GameArchiveLoader._currentDownloadBytes += delta;\n                GameArchiveLoader.notifyDownloadProgress();\n            },\n            function (error) {\n                GameArchiveLoader.notifyFileDownloadError(error);\n            },\n            function (response) {\n                piece.data = new Uint8Array(response);\n                piece.dataLength = piece.data.length;\n                total = piece.dataLength;\n                downloaded = piece.dataLength;\n                GameArchiveLoader.onPieceLoaded(file, piece);\n                GameArchiveLoader.notifyDownloadProgress();\n                piece.data = undefined;\n            });\n    },\n\n    addPieceToFile: function(file, piece) {\n        if (1 == file.pieces.length) {\n            file.data = piece.data;\n        } else {\n            var start = piece.offset;\n            var end = start + piece.data.length;\n            if (0 > start) {\n                throw \"Buffer underflow\";\n            }\n            if (end > file.data.length) {\n                throw \"Buffer overflow\";\n            }\n            file.data.set(piece.data, piece.offset);\n        }\n    },\n\n    onPieceLoaded: function(file, piece) {\n        this.addPieceToFile(file, piece);\n\n        ++file.totalLoadedPieces;\n        // is all pieces of the file loaded?\n        if (file.totalLoadedPieces == file.pieces.length) {\n            this.onFileLoaded(file);\n        }\n        // continue loading more pieces of the file\n        // if not all pieces are already in progress\n        else {\n            var next = file.lastRequestedPiece + 1;\n            if (next < file.pieces.length) {\n                this.downloadPiece(file, next);\n            }\n        }\n    },\n\n    verifyFile: function(file) {\n        // verify that we downloaded as much as we were supposed to\n        var actualSize = 0;\n        for (var i=0;i<file.pieces.length; ++i) {\n            actualSize += file.pieces[i].dataLength;\n        }\n        if (actualSize != file.size) {\n            throw \"Unexpected data size\";\n        }\n\n        // verify the pieces\n        if (file.pieces.length > 1) {\n            var output = file.data;\n            var pieces = file.pieces;\n            for (i=0; i<pieces.length; ++i) {\n                var item = pieces[i];\n                // Bounds check\n                var start = item.offset;\n                var end = start + item.dataLength;\n                if (0 < i) {\n                    var previous = pieces[i - 1];\n                    if (previous.offset + previous.dataLength > start) {\n                        throw \"Segment underflow\";\n                    }\n                }\n                if (pieces.length - 2 > i) {\n                    var next = pieces[i + 1];\n                    if (end > next.offset) {\n                        throw \"Segment overflow\";\n                    }\n                }\n            }\n        }\n    },\n\n    onFileLoaded: function(file) {\n        this.verifyFile(file);\n        this.notifyFileLoaded(file);\n        ++this._fileIndex;\n        if (this._fileIndex == this._files.length) {\n            this.onArchiveLoaded();\n        } else {\n            this.downloadContent();\n        }\n    },\n\n    onArchiveLoaded: function() {\n        this.isCompleted = true;\n        this.notifyArchiveLoaded();\n    }\n};\n\n/* ********************************************************************* */\n/* Default splash and progress visualisation                             */\n/* ********************************************************************* */\n\nvar Progress = {\n    progress_id: \"defold-progress\",\n    bar_id: \"defold-progress-bar\",\n\n    listeners: [],\n\n    addListener: function(callback) {\n        if (typeof callback !== 'function') throw \"Invalid callback registration\";\n        this.listeners.push(callback);\n    },\n\n    notifyListeners: function(percentage) {\n        for (i=0; i<this.listeners.length; ++i) {\n            this.listeners[i](percentage);\n        }\n    },\n\n    addProgress : function (canvas) {\n        /* Insert default progress bar below canvas */\n        canvas.insertAdjacentHTML('afterend', '<div id=\"' + Progress.progress_id + '\" class=\"canvas-app-progress\"><div id=\"' + Progress.bar_id + '\" class=\"canvas-app-progress-bar\" style=\"width: 0%;\"></div></div>');\n        Progress.bar = document.getElementById(Progress.bar_id);\n        Progress.progress = document.getElementById(Progress.progress_id);\n    },\n\n    updateProgress: function(percentage) {\n        if (Progress.bar) {\n            Progress.bar.style.width = percentage + \"%\";\n        }\n        Progress.notifyListeners(percentage);\n    },\n\n    calculateProgress: function (from, to, current, total) {\n        this.updateProgress(from + (current / total) * (to - from));\n    },\n\n    removeProgress: function () {\n        if (Progress.progress.parentElement !== null) {\n            Progress.progress.parentElement.removeChild(Progress.progress);\n\n            // Remove any background/splash image that was set in runApp().\n            // Workaround for Safari bug DEF-3061.\n            Module.canvas.style.background = \"\";\n        }\n    }\n};\n\n/* ********************************************************************* */\n/* Default input override                                                */\n/* ********************************************************************* */\n\nvar CanvasInput = {\n    arrowKeysHandler : function(e) {\n        switch(e.keyCode) {\n            case 37: case 38: case 39:  case 40: // Arrow keys\n            case 32: e.preventDefault(); e.stopPropagation(); // Space\n            default: break; // do not block other keys\n        }\n    },\n\n    onFocusIn : function(e) {\n        window.addEventListener(\"keydown\", CanvasInput.arrowKeysHandler, false);\n    },\n\n    onFocusOut: function(e) {\n        window.removeEventListener(\"keydown\", CanvasInput.arrowKeysHandler, false);\n    },\n\n    addToCanvas : function(canvas) {\n        canvas.addEventListener(\"focus\", CanvasInput.onFocusIn, false);\n        canvas.addEventListener(\"blur\", CanvasInput.onFocusOut, false);\n        canvas.focus();\n        CanvasInput.onFocusIn();\n    }\n};\n\n/* ********************************************************************* */\n/* Module is Emscripten namespace                                        */\n/* ********************************************************************* */\n\nvar Module = {\n    noInitialRun: true,\n\n    _filesToPreload: [],\n    _archiveLoaded: false,\n    _preLoadDone: false,\n    _waitingForArchive: false,\n\n    // Persistent storage\n    persistentStorage: true,\n    _syncInProgress: false,\n    _syncNeeded: false,\n    _syncInitial: false,\n    _syncMaxTries: 3,\n    _syncTries: 0,\n\n    arguments: [],\n\n    print: function(text) { console.log(text); },\n    printErr: function(text) { console.error(text); },\n\n    setStatus: function(text) { console.log(text); },\n\n    isWASMSupported: (function() {\n        try {\n            if (typeof WebAssembly === \"object\" && typeof WebAssembly.instantiate === \"function\") {\n                const module = new WebAssembly.Module(Uint8Array.of(0x0, 0x61, 0x73, 0x6d, 0x01, 0x00, 0x00, 0x00));\n                if (module instanceof WebAssembly.Module)\n                    return new WebAssembly.Instance(module) instanceof WebAssembly.Instance;\n            }\n        } catch (e) {\n        }\n        return false;\n    })(),\n\n    prepareErrorObject: function (err, url, line, column, errObj) {\n        line = typeof line == \"undefined\" ? 0 : line;\n        column = typeof column == \"undefined\" ? 0 : column;\n        url = typeof url == \"undefined\" ? \"\" : url;\n        var errorLine = url + \":\" + line + \":\" + column;\n\n        var error = errObj || (typeof window.event != \"undefined\" ? window.event.error : \"\" ) || err || \"Undefined Error\";\n        var message = \"\";\n        var stack = \"\";\n        var backtrace = \"\";\n\n        if (typeof error == \"object\" && typeof error.stack != \"undefined\" && typeof error.message != \"undefined\") {\n            stack = String(error.stack);\n            message = String(error.message);\n        } else {\n            stack = String(error).split(\"\\n\");\n            message = stack.shift();\n            stack = stack.join(\"\\n\");\n        }\n        stack = stack || errorLine;\n\n        var callLine = /at (\\S+:\\d*$)/.exec(message);\n        if (callLine) {\n            message = message.replace(/(at \\S+:\\d*$)/, \"\");\n            stack = callLine[1] + \"\\n\" + stack;\n        }\n\n        message = message.replace(/(abort\\(.+\\)) at .+/, \"$1\");\n        stack = stack.replace(/\\?{1}\\S+(:\\d+:\\d+)/g, \"$1\");\n        stack = stack.replace(/ *at (\\S+)$/gm, \"@$1\");\n        stack = stack.replace(/ *at (\\S+)(?: \\[as \\S+\\])? +\\((.+)\\)/g, \"$1@$2\");\n        stack = stack.replace(/^((?:Object|Array)\\.)/gm, \"\");\n        stack = stack.split(\"\\n\");\n\n        return { stack:stack, message:message };\n    },\n\n    hasWebGLSupport: function() {\n        var webgl_support = false;\n        try {\n            var canvas = document.createElement(\"canvas\");\n            var gl = canvas.getContext(\"webgl\") || canvas.getContext(\"experimental-webgl\");\n            if (gl && gl instanceof WebGLRenderingContext) {\n                webgl_support = true;\n            }\n        } catch (error) {\n            console.log(\"An error occurred while detecting WebGL support: \" + error);\n            webgl_support = false;\n        }\n\n        return webgl_support;\n    },\n\n    handleVisibilityChange: function () {\n        GLFW.onFocusChanged(document[Module.hiddenProperty] ? 0 : 1);\n    },\n\n    getHiddenProperty: function () {\n        if ('hidden' in document) return 'hidden';\n        var prefixes = ['webkit','moz','ms','o'];\n        for (var i = 0; i < prefixes.length; i++) {\n            if ((prefixes[i] + 'Hidden') in document)\n                return prefixes[i] + 'Hidden';\n        }\n        return null;\n    },\n\n    setupVisibilityChangeListener: function() {\n        Module.hiddenProperty = Module.getHiddenProperty();\n        if( Module.hiddenProperty ) {\n            var eventName = Module.hiddenProperty.replace(/[H|h]idden/,'') + 'visibilitychange';\n            document.addEventListener(eventName, Module.handleVisibilityChange, false);\n        } else {\n            console.log(\"No document.hidden property found. The focus events won't be enabled.\")\n        }\n    },\n\n    setupCanvas: function(appCanvasId) {\n        appCanvasId = (typeof appCanvasId === 'undefined') ? 'canvas' : appCanvasId;\n        Module.canvas = document.getElementById(appCanvasId);\n        return Module.canvas;\n    },\n\n\n    /**\n    * Module.runApp - Starts the application given a canvas element id\n    *\n    * 'extra_params' is an optional object that can have the following fields:\n    *\n    *     'archive_location_filter':\n    *         Filter function that will run for each archive path.\n    *\n    *     'unsupported_webgl_callback':\n    *         Function that is called if WebGL is not supported.\n    *\n    *     'engine_arguments':\n    *         List of arguments (strings) that will be passed to the engine.\n    *\n    *     'persistent_storage':\n    *         Boolean toggling the usage of persistent storage.\n    *\n    *     'custom_heap_size':\n    *         Number of bytes specifying the memory heap size.\n    *\n    *     'disable_context_menu':\n    *         Disables the right-click context menu on the canvas element if true.\n    *\n    *     'retry_time':\n    *         Pause before retry file loading after error.\n    *\n    *     'retry_count':\n    *         How many attempts we do when trying to download a file.\n    *\n    *     'can_not_download_file_callback':\n    *         Function that is called if you can't download file after 'retry_count' attempts.\n    **/\n    runApp: function(appCanvasId, extra_params) {\n        Module.setupCanvas(appCanvasId);\n\n        var params = {\n            archive_location_filter: function(path) { return 'split' + path; },\n            unsupported_webgl_callback: undefined,\n            engine_arguments: [],\n            persistent_storage: true,\n            custom_heap_size: undefined,\n            disable_context_menu: true,\n            retry_time: 1,\n            retry_count: 10,\n            can_not_download_file_callback: undefined,\n        };\n\n        for (var k in extra_params) {\n            if (extra_params.hasOwnProperty(k)) {\n                params[k] = extra_params[k];\n            }\n        }\n\n        Module.arguments = params[\"engine_arguments\"];\n        Module.persistentStorage = params[\"persistent_storage\"];\n\n        var fullScreenContainer = params[\"full_screen_container\"];\n        if (typeof fullScreenContainer === \"string\") {\n            fullScreenContainer = document.querySelector(fullScreenContainer);\n        }\n        Module.fullScreenContainer = fullScreenContainer || Module.canvas;\n\n        if (Module.hasWebGLSupport()) {\n            // Override game keys\n            CanvasInput.addToCanvas(Module.canvas);\n\n            Module.setupVisibilityChangeListener();\n\n            // Add context menu hide-handler if requested\n            if (params[\"disable_context_menu\"])\n            {\n                Module.canvas.oncontextmenu = function(e) {\n                    e.preventDefault();\n                };\n            }\n\n            FileLoader.options.retryCount = params[\"retry_count\"];\n            FileLoader.options.retryInterval = params[\"retry_time\"] * 1000;\n            if (typeof params[\"can_not_download_file_callback\"] === \"function\") {\n                GameArchiveLoader.addFileDownloadErrorListener(params[\"can_not_download_file_callback\"]);\n            }\n            // Load and assemble archive\n            GameArchiveLoader.addFileLoadedListener(Module.onArchiveFileLoaded);\n            GameArchiveLoader.addArchiveLoadedListener(Module.onArchiveLoaded);\n            GameArchiveLoader.setFileLocationFilter(params[\"archive_location_filter\"]);\n            GameArchiveLoader.loadArchiveDescription('/archive_files.json');\n        } else {\n            Progress.updateProgress(100, \"Unable to start game, WebGL not supported\");\n            Module.setStatus = function(text) {\n                if (text) Module.printErr('[missing WebGL] ' + text);\n            };\n\n            if (typeof params[\"unsupported_webgl_callback\"] === \"function\") {\n                params[\"unsupported_webgl_callback\"]();\n            }\n        }\n    },\n\n    onArchiveFileLoaded: function(file) {\n        Module._filesToPreload.push({path: file.name, data: file.data});\n    },\n\n    onArchiveLoaded: function() {\n        GameArchiveLoader.cleanUp();\n        Module._archiveLoaded = true;\n        Progress.updateProgress(100, \"Starting...\");\n\n        if (Module._waitingForArchive) {\n            Module._preloadAndCallMain();\n        }\n    },\n\n    toggleFullscreen: function(element) {\n        if (GLFW.isFullscreen) {\n            GLFW.cancelFullScreen();\n        } else {\n            GLFW.requestFullScreen(element);\n        }\n    },\n\n    preSync: function(done) {\n        // Initial persistent sync before main is called\n        FS.syncfs(true, function(err) {\n            if(err) {\n                Module._syncTries += 1;\n                console.error(\"FS syncfs error: \" + err);\n                if (Module._syncMaxTries > Module._syncTries) {\n                    Module.preSync(done);\n                } else {\n                    Module._syncInitial = true;\n                    done();\n                }\n            } else {\n                Module._syncInitial = true;\n                if (done !== undefined) {\n                    done();\n                }\n            }\n        });\n    },\n\n    preloadAll: function() {\n        if (Module._preLoadDone) {\n            return;\n        }\n        Module._preLoadDone = true;\n        for (var i = 0; i < Module._filesToPreload.length; ++i) {\n            var item = Module._filesToPreload[i];\n            FS.createPreloadedFile(\"\", item.path, item.data, true, true);\n        }\n    },\n\n    // Tries to do a MEM->IDB sync\n    // It will flag that another one is needed if there is already one sync running.\n    persistentSync: function() {\n\n        // Need to wait for the initial sync to finish since it\n        // will call close on all its file streams which will trigger\n        // new persistentSync for each.\n        if (Module._syncInitial) {\n            if (Module._syncInProgress) {\n                Module._syncNeeded = true;\n            } else {\n                Module._startSyncFS();\n            }\n        }\n    },\n\n    preInit: [function() {\n        /* Mount filesystem on preinit */\n        var dir = DMSYS.GetUserPersistentDataRoot();\n        FS.mkdir(dir);\n\n        // If IndexedDB is supported we mount the persistent data root as IDBFS,\n        // then try to do a IDB->MEM sync before we start the engine to get\n        // previously saved data before boot.\n        window.indexedDB = window.indexedDB || window.mozIndexedDB || window.webkitIndexedDB || window.msIndexedDB;\n        if (Module.persistentStorage && window.indexedDB) {\n            FS.mount(IDBFS, {}, dir);\n\n            // Patch FS.close so it will try to sync MEM->IDB\n            var _close = FS.close; FS.close = function(stream) { var r = _close(stream); Module.persistentSync(); return r; }\n\n            // Sync IDB->MEM before calling main()\n            Module.preSync(function() {\n                Module._preloadAndCallMain();\n            });\n        } else {\n            Module._preloadAndCallMain();\n        }\n    }],\n\n    preRun: [function() {\n        /* If archive is loaded, preload all its files */\n        if(Module._archiveLoaded) {\n            Module.preloadAll();\n        }\n    }],\n\n    postRun: [function() {\n        if(Module._archiveLoaded) {\n            Progress.removeProgress();\n        }\n    }],\n\n    _preloadAndCallMain: function() {\n        // If the archive isn't loaded,\n        // we will have to wait with calling main.\n        if (!Module._archiveLoaded) {\n            Module._waitingForArchive = true;\n        } else {\n            Module.preloadAll();\n            Progress.removeProgress();\n            if (Module.callMain === undefined) {\n                Module.noInitialRun = false;\n            } else {\n                Module.callMain(Module.arguments);\n            }\n        }\n    },\n\n    // Wrap IDBFS syncfs call with logic to avoid multiple syncs\n    // running at the same time.\n    _startSyncFS: function() {\n        Module._syncInProgress = true;\n\n        if (Module._syncMaxTries > Module._syncTries) {\n            FS.syncfs(false, function(err) {\n                Module._syncInProgress = false;\n\n                if (err) {\n                    console.error(\"Module._startSyncFS error: \" + err);\n                    Module._syncTries += 1;\n                }\n\n                if (Module._syncNeeded) {\n                    Module._syncNeeded = false;\n                    Module._startSyncFS();\n                }\n\n            });\n        }\n    },\n};\n\nwindow.onerror = function(err, url, line, column, errObj) {\n    if (typeof Module.ccall !== 'undefined') {\n        var errorObject = Module.prepareErrorObject(err, url, line, column, errObj);\n        Module.ccall('JSWriteDump', 'null', ['string'], [JSON.stringify(errorObject.stack)]);\n    }\n    Module.setStatus('Exception thrown, see JavaScript console');\n    Module.setStatus = function(text) {\n        if (text) Module.printErr('[post-exception status] ' + text);\n    };\n};\n"],"names":["FileLoader","options","retryCount","retryInterval","request","url","method","responseType","currentAttempt","obj","send","onprogress","this","onload","onerror","xhr","XMLHttpRequest","open","e","setTimeout","bind","size","callback","undefined","readyState","status","total","getResponseHeader","load","estimatedSize","lengthComputable","loaded","contentLength","res","response","JSON","parse","EngineLoader","wasm_size","wasm_from","wasm_to","wasmjs_size","wasmjs_from","wasmjs_to","asmjs_size","asmjs_from","asmjs_to","loadWasmAsync","src","fromProgress","toProgress","Progress","calculateProgress","error","wasm","Module","instantiateWasm","imports","successCallback","WebAssembly","instantiate","Uint8Array","then","output","instance","catch","console","log","loadScriptAsync","tag","document","createElement","text","head","appendChild","appCanvasId","exeName","addProgress","setupCanvas","GameArchiveLoader","_files","_fileIndex","isCompleted","_onFileLoadedListeners","_onArchiveLoadedListeners","_onFileDownloadErrorListeners","_currentDownloadBytes","_totalDownloadBytes","_archiveLocationFilter","path","cleanUp","_onGameArchiveLoaderCompletedListeners","_onAllTargetsBuiltListeners","addListener","list","push","notifyListeners","data","i","length","addFileDownloadErrorListener","notifyFileDownloadError","addFileLoadedListener","notifyFileLoaded","file","name","addArchiveLoadedListener","notifyArchiveLoaded","setFileLocationFilter","filter","loadArchiveDescription","descriptionUrl","json","onReceiveDescription","content","downloadContent","pieces","limit","MAX_CONCURRENT_XHR","Math","min","downloadPiece","notifyDownloadProgress","index","lastRequestedPiece","piece","totalLoadedPieces","downloaded","delta","dataLength","onPieceLoaded","addPieceToFile","start","offset","end","set","onFileLoaded","next","verifyFile","actualSize","item","previous","onArchiveLoaded","progress_id","bar_id","listeners","percentage","canvas","insertAdjacentHTML","bar","getElementById","progress","updateProgress","style","width","from","to","current","removeProgress","parentElement","removeChild","background","CanvasInput","arrowKeysHandler","keyCode","preventDefault","stopPropagation","onFocusIn","window","addEventListener","onFocusOut","removeEventListener","addToCanvas","focus","noInitialRun","_filesToPreload","_archiveLoaded","_preLoadDone","_waitingForArchive","persistentStorage","_syncInProgress","_syncNeeded","_syncInitial","_syncMaxTries","_syncTries","arguments","print","printErr","setStatus","isWASMSupported","module","of","Instance","prepareErrorObject","err","line","column","errObj","errorLine","event","message","stack","String","split","shift","join","callLine","exec","replace","hasWebGLSupport","webgl_support","gl","getContext","WebGLRenderingContext","handleVisibilityChange","GLFW","onFocusChanged","hiddenProperty","getHiddenProperty","prefixes","setupVisibilityChangeListener","eventName","runApp","extra_params","k","params","archive_location_filter","unsupported_webgl_callback","engine_arguments","persistent_storage","custom_heap_size","disable_context_menu","retry_time","retry_count","can_not_download_file_callback","hasOwnProperty","fullScreenContainer","querySelector","oncontextmenu","onArchiveFileLoaded","_preloadAndCallMain","toggleFullscreen","element","isFullscreen","cancelFullScreen","requestFullScreen","preSync","done","FS","syncfs","preloadAll","createPreloadedFile","persistentSync","_startSyncFS","preInit","_close","dir","DMSYS","GetUserPersistentDataRoot","mkdir","indexedDB","mozIndexedDB","webkitIndexedDB","msIndexedDB","mount","IDBFS","close","stream","r","preRun","postRun","callMain","ccall","errorObject","stringify"],"mappings":"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"}